---
title: "Semaine 6 - Tests statistiques classiques"
lang: fr
date: "Semaine 6"
output:
  pdf_document:
    toc: true
  html_document:
    toc: true
    toc_float: true
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=8, fig.height=4)
```

## Objectifs

Les objectifs sont de dresser un inventaire des principaux tests statistiques à travers des situations concrètes, notamment la comparaison de moyennes et les tests d'indépendance (test du chi deux).
On cherchera à comprendre et interpréter la notion de significativité statistique d'un test.

## Exercice 1. Poids moyen de chiots d’une race spécifique de chien

Un éleveur affirme que le poids moyen à la naissance des chiots d’une race de chiens est de 500 g.
Pour vérifier cette affirmation, un vétérinaire pèse 10 chiots issus de différentes portées et obtient les résultats suivants en grammes (g) :

```{r}
x = c(480, 520, 510, 495, 505, 490, 515, 525, 470, 485)
```

Nous souhaitons tester si le poids moyen des chiots est différent de 500 g (pour un niveau de significativité à préciser).

### Question 1

Décrire l'hypothèse nulle à tester, ainsi que l'hypothèse alternative.
Quel test classique peut être effectué ?

L'hypothèse nulle est "le poids moyen des chiens est de 500g" L'hyptohèse alternative est " le poids moyens des chiens est différente de 500g"

**Solution.**

### Question 2

Pour l'échantillon, calculer la statistique de test, $t$, associée à ce test.

**Solution.**

```{r}
# taille de l'échantillon
n = length(x)

# calcul de la moyenne
x_bar = sum(x)/n

# calcul de l'écart-type
s = sd(x)

# calcul de la stat t
cat("calcul de la statistique de test t : \n")

t_stat= sqrt(n) * (x_bar - 500) / s
t_stat
```

### Question 3

Calculer la valeur $p$ de significativité du test.

$$
p = \mathbb{P}( |T_n|  > |t| )
$$

où $T_n$ est une variable aléatoire de loi de Student à $(n-1)$ degrés de liberté.
Le test est-il significatif au seuil 5% ?
Conclure.
Non

**Solution.** Compléter le code suivant

```{r}
# On utilise pt(., df = n-1, lower = FALSE) 
p = 2 * pt(abs(t_stat),df = n-1, lower=FALSE)
p
```

Les données semblent-elles compatibles avec l'affirmation de l'éleveur ?
Oui elles semblent compatibles

### Question 4

Vérifier le résultat précédent à l'aide la commande `t.test` et donner un intervalle de confiance au seuil 5% pour la taille moyenne des chiots.
Que constatez-vous ?

**Solution.**

```{r}
# One Sample t-test
# On utilise t.test() mais pas n'importe comment
# completer 

t.test(x,mu = x_bar, conf.level = 0.95)
```

L'intervalle de confiance est contenu dans l'objet créé par la commande `t.test`.
On peut le retrouver dans le résumé de cet objet.

```{r}
# objet créé par la commande
objet = t.test(x,mu = x_bar, conf.level = 0.95)
# obj$lebonargument
```

La valeur 500 se trouve-t-elle dans l'intervalle de confiance ?
L’échantillon est-il cohérent avec l’affirmation de l’éleveur.
Oui 500 est dans l'intervalle de confiance, l'échantillon est donc cohérent avec l'affirmation de l'éleveur.
------------------------------------------------------------------------

## Exercice 2 - Scores en mathématiques

On souhaite tester si les scores en mathématiques de garçons et de filles issus du tableau ci-dessous sont significativement différents.

| Genre   | Moyenne ($\bar{X}$) | Écart-type ($s$) | Effectif ($n$) |
|---------|---------------------|------------------|----------------|
| Garçons | 75                  | 10               | 30             |
| Filles  | 70                  | 12               | 30             |

```{r}
garcons = c(75,10,30)
filles = c(70,12,30)
```

### Question 1

Proposer un test de significativité et calculer une $p$-valeur pour ce test.
Les écarts-types sont estimés sans biais.
On fait faire un test de Student pour des échantillons indépendants.

**Solution.** On applique la formule du test $t$ pour deux échantillons.
Calculer en premier lieu la variance (pooled) pour le test et la statistique $t$, puis établir le résultat à l'aide de la commande R.

La valeur $p$ est égale à

```{r, eval=TRUE}
## calcul de la p-valeur
n_1 = 30
n_2 = 30
s_1 = 10
s_2 = 12
x_1 = 75
x_2 = 70

sp2 = ((n_1-1)*s_1*s_1 + (n_2-1)*s_2*s_2)/(n_1+n_2-2)


t = (x_1 - x_2)/sqrt(sp2*(1/n_1+1/n_2))

pvaleur = 2*  pt(abs(t),df = n_1+n_2-2, lower=FALSE)
pvaleur
if (round(pvaleur, 3) != 0.085) {cat("Ah, tu t'es trompée ! \n")}
```

Il reste à établir le résultat à l'aide de la commande R.

### Question 2

Les moyennes des filles et des garçons sont-elles significativement différentes au seuil 5% ?
Non

**Solution.**

------------------------------------------------------------------------

## Exercice 3 - Données anatomiques de chats domestiques

On étudie un jeu de données présentant le poids du cœur et du corps de chats mâles et femelles utilisés dans des expériences sur la digitaline.
Tous les chats étaient adultes et pesaient plus de 2 kg.
(Référence : R. A. Fisher (1947), *The analysis of covariance method for the relation between a part and the whole*, Biometrics, 3, 65–68.)

Les variables sont :

-   Sexe (Sex) : Facteur indiquant le sexe du chat ("F" pour femelle, "M" pour mâle).
-   Poids corporel (Bwt) : Poids du corps en kg.
-   Poids du cœur (Hwt) : Poids du cœur en g.

```{r}
library(MASS)
data(cats)
```

### Question 1

A l'aide de boîtes à moustaches, comparer graphiquement les données relatives au poids du cœur chez les mâles et les femelles.
Évaluer la différence des poids moyens entre les deux sexes.
Résumer et commenter le résultat.

**Solution.** Expliquer rapidement ce que représente une [boîte à moustaches](https://fr.wikipedia.org/wiki/Boîte_à_moustaches) puis utiliser la commande R appropriée.

```{r}
# commenter : boite a moustaches = boxplot
# boxplot(la_bonne_formule, data = cats, col = c("pink", "lightblue"))
```

La différence des poids du cœur moyens se calcule de la manière suivante (compléter).

```{r}
# calcule la difference inter-sexe
# on peut utiliser with(cats, )
with(cats, complete_moi)
```

### Question 2

Les données concernant le poids du cœur des mâles peuvent-elles considérées comme étant échantillonnées selon la loi normale ?
Même question pour les femelles.
Tester graphiquement à l'aide de la fonction `qqnorm`, puis à l'aide `shapiro.test`.
Interpréter les résultats obtenus.

**Solution.**

```{r}
## deux graphiques males et femelles
par(mfrow = c(1,2))
#qqnorm(scale(poids_des_males) ; abline(0, 1, col = 2)
#qqnorm(scale(poids_des_femelles)) ; abline(0, 1, col = 2)
```

```{r}
## tests de Shapiro
```

### Question 3

On suppose les données issues de la loi normale.
Proposer un test de significativité pour la difference moyenne de poids du coeur entre les deux sexes et calculer une $p$-valeur pour ce test.

**Solution.** On applique la formule de calcul de la statistique de test $t$ et on obtient une $p$-valeur.
La variance (pooled) est donnée par

$$
s_p^2 = {\rm merci ~wikipedia} = 4.966619
$$

et la statistique de Student est égale à

$$
t  = 5.353924
$$

```{r}
# on calcule tout ca en R
# la formule de la statistique de test

# calcul de la variance pooled : cf resumé des tests
# sp2 = merci_wikipedia

# calcul de la t.stat : cf resumé des tests
# t.stat = merci_encore

# t.stat
```

La valeur $p$ est égale à

```{r}
# on utilise la fonction de repartition de la loi t
2*pt(quoi_remplace, lower = FALSE)
```

Que conclut-on ?

### Question 4

Calculer une $p$-valeur pour ce test à l'aide de la commande `t.test` avec la condition d'égalité des variances.
Effectuer le test avec cette commande et les options par défaut.
Expliquer brièvement les différences entre les deux cas.
Interpréter les résultats.

**Solution.** En supposant l'équalité des variances, on a

```{r}
## commenter. 
## utiliser eventuellement une autre syntaxe que la formule Hwt~Sex
t.test(Hwt~Sex, data = cats, var.equal = TRUE)
```

------------------------------------------------------------------------

# Les exercices suivants sont facultatifs. On les traitera si on a le temps.

------------------------------------------------------------------------

## Exercice 4 – Choix d’un moyen de transport

Une ville souhaite analyser si le choix du moyen de transport dépend du quartier de résidence.
On interroge 150 habitants de deux quartiers différents et on obtient le tableau de contingence suivant :

|                | Bus | Vélo | Voiture | Total |
|----------------|-----|------|---------|-------|
| **Quartier A** | 30  | 10   | 35      | 75    |
| **Quartier B** | 20  | 25   | 30      | 75    |
| **Total**      | 50  | 35   | 65      | 150   |

Nous souhaitons tester si le quartier de résidence influence le choix du moyen de transport.

```{r}
X = matrix(c(30, 10, 35, 20 , 25, 30), byrow = TRUE, nrow = 2, ncol = 3)
rownames(X) = c("A", "B")
colnames(X) = c("bus", "vélo", "voiture")
X
```

### Question 1

Décrire l'hypothèse nulle à tester, ainsi que l'hypothèse alternative.
Quel test peut être effectué ?

H_0 est : "Les deux variables "Quartier" et "mode de transport" sont indépendantes" H_1 est "il existe une association entre les deux variables" **Solution.**

### Question 2

On choisit de tester l'hypothèse nulle à l'aide d'un test du $\chi^2$.
On effectue ce test manuellement, sans utiliser la commande `chisq.test`.
Calculer les effectifs attendus $E_{ij}$ sous l'hypothèse d'indépendance

**Solution.** Pour tout $i,j = 1,2$,

$$
E_{ij} = \frac{\text{Total ligne}_i \times \text{Total colonne}_j }{\text{Total général}}.
$$

```{r}
# taille de l'échantillon
n = 150

# calcul des valeurs attendues (sous forme matricielle)
Ei = apply(X, 1, sum)
Ej = apply(X, 2, sum)
Eij = trouve_la_formule_matricielle (%*% désigne le produit de matrice, t() la transposition)

rownames(Eij) = c("A", "B")
Eij
```

### Question 3

Calculer la statistique du Chi-deux, donnée par la formule suivante

$$
\chi^2 = \sum_{ij} \frac{(O_{ij} - E_{ij})^2}{E_{ij}}.
$$

**Solution.**

```{r}
# calcul de la statistique de test
#chi_2 = remplace_moi
#chi_2
```

### Question 4

Déterminer la $p$-valeur du test du Chi-deux

**Solution.** Commencer par déterminer le nombre de degré de liberté pour le test

```{r}
# on utilise la fonction de repartion de la loi chi2
#p = pchisq_complete
#p
```

### Question 5

La $p$-valeur est-elle plus petite que le **seuil 5%** ($\alpha = 0.05$) ?
Conclure.
Le choix du moyen de transport dépend-il significativement du quartier de résidence ?

**Solution.**

### Question 6

Vérifier les résultats obtenus à l'aide de la commande `chisq.test`

**Solution.**

```{r}
chisq.test(X)
```

## Exercice 5 – Quelques exemples contre-intuitifs.

### Question 1

On considère les deux échantillons de taille $n = 2$ suivants

```{r}
x = c(9,10)
y = c(9,100)
```

On suppose que ces échantillons sont issus d'une loi normale.
Estimer la moyenne de chaque échantillon.

Tester la nullité de la moyenne dans les deux cas.
Les résultats semblent-ils paradoxaux ?
Expliquer pourquoi ils ne le sont pas.

**Solution.** Hum hum, ce n'est pas qu'une affaire de moyenne...

### Question 2

Dans la classe de Martine et Robert, il y a $n = 34$ élèves.
À l'élection des délégués de classe, Martine remporte 18 voix et Robert remporte 16 voix.

-   Quelle est la proportion de votes pour Martine ?\
-   Donner un intervalle de confiance pour cette proportion.\
-   La proportion différe-t-elle significativement de 1/2 ?\
-   Quelle est la probabilité pour que Martine soit élue ?\

Répondre à ces questions ou suggérer à une intelligence artificielle générative de le faire.
Analyser les réponses.

**Solution.** oui, tu as bien lu.
Suggère cet énoncé au chat de la silicon valley, et réfléchis aux réponses de ton coté.
Tu riras peut être bien d'avoir piégé le chat.

### Question 3

Robert va à la pêche dans l'étang et attrape $n = 20$ poissons, qu'il relache après les avoir mesurés.
La taille moyenne des poissons est 16.2 cm et l'écart-type est 3.3 cm.

On sait qu'il y a 21 poissons dans l'étang.
La taille moyenne des poissons est-elle significativement supérieure à 15.9 cm ?

**Solution.** Nous travaillons avec une population quasi-entière, et donc l'utilisation d'un estimateur basé sur un échantillon devient moins pertinente.
Introduire le facteur de correction pour une population finie (cf. wikipedia).
